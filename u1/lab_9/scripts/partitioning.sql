--===========================================
-- RANG PARTITIONING
--===========================================

-- Table SALES
CREATE TABLE SALES
(
    sale_id NUMBER(10),
    time_id DATE,
    product_id NUMBER(10),
    amount NUMBER(10)
)
PARTITION BY RANGE (time_id)
(
    PARTITION SALES_2021 VALUES LESS THAN (TO_DATE('01/01/2022', 'DD/MM/YYYY')),
    PARTITION SALES_2022 VALUES LESS THAN (TO_DATE('01/01/2023', 'DD/MM/YYYY'))
)
TABLESPACE TS_REFERENCES_EXT_DATA_01;

INSERT INTO SALES VALUES(1, TO_DATE('10/01/2021', 'DD/MM/YYYY'), 1, 1);
INSERT INTO SALES VALUES(2, TO_DATE('11/01/2021', 'DD/MM/YYYY'), 2, 1);
INSERT INTO SALES VALUES(3, TO_DATE('10/01/2022', 'DD/MM/YYYY'), 1, 1);
INSERT INTO SALES VALUES(4, TO_DATE('11/01/2022', 'DD/MM/YYYY'), 2, 1);
commit;

-- Merge partitions
ALTER TABLE SALES
MERGE PARTITIONS SALES_2021, SALES_2022
INTO PARTITION SALES_2021_2022;

-- Move partitions
ALTER TABLE SALES
MOVE PARTITION SALES_2021_2022
TABLESPACE TS_REFERENCES_DATA_01 NOLOGGING COMPRESS;

-- Split partition
ALTER TABLE SALES SPLIT PARTITION SALES_2021_2022
AT (TO_DATE('01/01/2022', 'DD/MM/YYYY'))
INTO (PARTITION SALES_2021, PARTITION SALES_2022);

-- Truncate partition SALES_2021
ALTER TABLE SALES TRUNCATE PARTITION SALES_2021;

-- Drop partition SALES_2021
ALTER TABLE SALES DROP PARTITION SALES_2021;

-- Add partition SALES_2023
ALTER TABLE SALES
ADD PARTITION SALES_2023 VALUES LESS THAN (TO_DATE('01/01/2024', 'DD/MM/YYYY'))
TABLESPACE TS_REFERENCES_EXT_DATA_01;
